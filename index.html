<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ビンゴカードジェネレータ</title>
</head>
<body>
<article>
<h1>ビンゴカードジェネレータ</h1>
<p>ページを更新するたびに番号が変わります。</p>
<canvas id="canvas"></canvas>
<script>

function* randomIntGenerator(min, max) {
    while (true) {
        yield min + Math.floor(Math.random() * (max - min + 1));
    }
}

const img = new Image();

img.addEventListener('load', onImgLoad);
img.src = 'EzYm4SQVgAE7wXi.png';

function onImgLoad() {
    const canvas = document.querySelector('#canvas');
    canvas.width = img.width;
    canvas.height = img.height;

    const ctx = canvas.getContext('2d');
    ctx.drawImage(img, 0, 0);

    const cellXs = [65, 182, 306, 426, 557, 677];
    const cellYs = [200, 315, 439, 567, 691, 818];
    const borderWidth = 5;

    const fontSize = 60;
    ctx.font = fontSize + 'px serif';

    const selectedNums = [];
    for (let i = 0; i < cellYs.length - 1; i++) {
        for (let j = 0; j < cellXs.length - 1; j++) {
            if (i == 2 && j == 2) {
                continue;
            }

            const left   = cellXs[j];
            const top    = cellYs[i];
            const right  = cellXs[j + 1] - borderWidth;
            const bottom = cellYs[i + 1] - borderWidth;

            const x = left + (right - left - fontSize) / 2;
            const y = bottom - (bottom - top - fontSize) / 2;

            let num;
            while (true) {
                num = randomIntGenerator(1, 75).next().value;
                if (selectedNums.includes(num)) {
                    continue;
                }
                selectedNums.push(num);
                break;
            }

            ctx.fillText(num, x, y);
        }
    }

    const cardUrl = canvas.toDataURL();

    const link = document.createElement('a');
    //link.style.display = 'none';
    link.href = cardUrl;
    link.download = '';
    link.innerText = 'ダウンロード';
    document.querySelector('article').appendChild(link);
}
</script>
</article>
<aside>
<header>更新履歴</header>
・2021/4/20 17:30 番号が重複するバグを修正
</aside>
</body>
</html>
