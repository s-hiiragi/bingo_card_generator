<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ビンゴカードジェネレータ</title>
</head>
<body>
<article>
<h1>ビンゴカードジェネレータ</h1>
<p>ページを更新するたびに番号が変わります。</p>
<div id="download_link_container"></div>
<canvas id="canvas"></canvas>
<script>

function* randomIntGenerator(min, max) {
    while (true) {
        yield min + Math.floor(Math.random() * (max - min + 1));
    }
}

function* uniqueRandomIntGenerator(min, max) {
    const generatedNums = [];

    for (const n of randomIntGenerator(min, max)) {
        if (generatedNums.includes(n)) {
            continue;
        }
        generatedNums.push(n);
        yield n;
    }
}

// @return [5][5]number
function generateBingoNums() {
    const gen = uniqueRandomIntGenerator(1, 75);

    const columns = [];
    for (let i = 0; i < 5; i++) {
        const column = [];
        for (let j = 0; j < 5; j++) {
            if (i == 2 && j == 2) {
                column.push(NaN);
                continue;
            }

            const n = gen.next().value;
            column.push(n);
        }
        columns.push(column);
    }
    return columns;
}

// @return [5][5]number
function generateBingoNumsByStandardRule() {
    const columns = [];
    for (let i = 0; i < 5; i++) {
        const g = uniqueRandomIntGenerator(i*15+1, (i+1)*15);
        const column = [];
        for (let j = 0; j < 5; j++) {
            if (i == 2 && j == 2) {
                column.push(NaN);
                continue;
            }

            const n = g.next().value;
            column.push(n);
        }
        columns.push(column);
    }
    return columns;
}

const blankCardImageUrl = 'EzYm4SQVgAE7wXi.png';
const cellXs = [65, 182, 306, 426, 557, 677];
const cellYs = [200, 315, 439, 567, 691, 818];
const borderWidth = 5;

const blankCardImage = new Image();

blankCardImage.addEventListener('load', blankCardImage_onLoad);
blankCardImage.src = blankCardImageUrl;

function blankCardImage_onLoad() {
    const cardNums = generateBingoNums();
    //const cardNums = generateBingoNumsByStandardRule();

    const canvas = document.querySelector('#canvas');
    canvas.width = blankCardImage.width;
    canvas.height = blankCardImage.height;

    const ctx = canvas.getContext('2d');
    ctx.drawImage(blankCardImage, 0, 0);

    const fontSize = 60;
    ctx.font = fontSize + 'px serif';

    for (let i = 0; i < 5; i++) {
        for (let j = 0; j < 5; j++) {
            if (i == 2 && j == 2) {
                continue;
            }

            const n = cardNums[i][j];

            const left   = cellXs[i];
            const top    = cellYs[j];
            const right  = cellXs[i + 1] - borderWidth;
            const bottom = cellYs[j + 1] - borderWidth;

            const numWidth = n >= 10 ? fontSize : fontSize / 2;
            const x = left + (right - left - numWidth) / 2;
            const y = bottom - (bottom - top - fontSize) / 2;

            ctx.fillText(n, x, y);
        }
    }

    const cardUrl = canvas.toDataURL();

    const container = document.querySelector('#download_link_container');
    container.innerHTML = '<a download>ダウンロード</a>';
    container.firstElementChild.href = cardUrl;
}
</script>
</article>
<aside>
<header>更新履歴</header>
・2021/4/20 17:30 番号が重複するバグを修正
</aside>
</body>
</html>
