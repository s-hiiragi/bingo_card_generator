<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ビンゴカードジェネレータ</title>
</head>
<body>
<article>
<h1>ビンゴカードジェネレータ</h1>
<p>ページを更新するたびに番号が変わります。</p>
<div id="download_link_container"></div>
<canvas id="canvas"></canvas>
<script>

function* randomIntGenerator(min, max) {
    while (true) {
        yield min + Math.floor(Math.random() * (max - min + 1));
    }
}

function* uniqueRandomIntGenerator(min, max) {
    const generatedNums = [];

    for (const n of randomIntGenerator(min, max)) {
        if (generatedNums.includes(n)) {
            continue;
        }
        generatedNums.push(n);
        yield n;
    }
}

const cardBackgroundUrl = 'EzYm4SQVgAE7wXi.png';
const cellXs = [65, 182, 306, 426, 557, 677];
const cellYs = [200, 315, 439, 567, 691, 818];
const borderWidth = 5;

const img = new Image();

img.addEventListener('load', onImgLoad);
img.src = cardBackgroundUrl;

function onImgLoad() {
    const canvas = document.querySelector('#canvas');
    canvas.width = img.width;
    canvas.height = img.height;

    const ctx = canvas.getContext('2d');
    ctx.drawImage(img, 0, 0);

    const fontSize = 60;
    ctx.font = fontSize + 'px serif';

    const gen = uniqueRandomIntGenerator(1, 75);

    for (let i = 0; i < cellYs.length - 1; i++) {
        for (let j = 0; j < cellXs.length - 1; j++) {
            if (i == 2 && j == 2) {
                continue;
            }

            const num = gen.next().value;

            const left   = cellXs[j];
            const top    = cellYs[i];
            const right  = cellXs[j + 1] - borderWidth;
            const bottom = cellYs[i + 1] - borderWidth;

            const x = left + (right - left - fontSize) / 2;
            const y = bottom - (bottom - top - fontSize) / 2;

            ctx.fillText(num, x, y);
        }
    }

    const cardUrl = canvas.toDataURL();

    const link = document.createElement('a');
    link.href = cardUrl;
    link.download = '';
    link.innerText = 'ダウンロード';
    document.querySelector('#download_link_container').appendChild(link);
}
</script>
</article>
<aside>
<header>更新履歴</header>
・2021/4/20 17:30 番号が重複するバグを修正
</aside>
</body>
</html>
